# Страницы и функции Telegram бота для учета расходов

## Команды (Commands)

| Команда | Описание |
|---------|----------|
| `/start` | Главное меню бота |
| `/help` | Справка и команды |
| `/total` | Общая статистика расходов |
| `/history` | История расходов за день |
| `/stats` | Детальная статистика по категориям |
| `/export` | Экспорт данных в CSV |
| `/undo` | Отмена последней записи |
| `/categories` | Управление категориями |
| `/currency` | Настройка валюты пользователя |
| `/timezone` | Настройка часового пояса |
| `/settings` | Настройки пользователя |
| `/limits` | Лимиты и премиум функции |
| `/menu` | Главное меню |

## Callback Actions (Обработчики кнопок)

### Основные действия
| Callback | Описание |
|----------|----------|
| `category\|` | Выбор категории для расхода |
| `cancel` | Отмена операции |
| `menu` | Главное меню |
| `stats` | Детальная статистика по категориям |
| `history` | История расходов за день |
| `categories` | Управление категориями |
| `settings` | Настройки пользователя |
| `undo` | Отмена последней записи |
| `help` | Справка и команды |
| `limits` | Лимиты и премиум функции |

### Настройки пользователя
| Callback | Описание |
|----------|----------|
| `set_currency\|` | Установка валюты пользователя |
| `change_currency` | Выбор валюты |
| `change_timezone` | Выбор часового пояса |
| `change_language` | Выбор языка интерфейса |
| `tz\|` | Установка часового пояса |
| `time\|` | Установка часового пояса (альтернативный формат) |
| `set_language\|` | Установка языка интерфейса |

### Навигация "Назад"
| Callback | Описание |
|----------|----------|
| `back_to_menu` | Возврат в главное меню |
| `back_to_settings` | Возврат в настройки |
| `back_to_categories` | Возврат к списку категорий |
| `back_to_history` | Возврат к истории расходов |
| `back_to_stats` | Возврат к статистике |
| `back` | Универсальный возврат назад |

### Управление записями расходов
| Callback | Описание |
|----------|----------|
| `show_category\|` | Список расходов по конкретной категории |
| `delete_expense\|` | Удаление записи расхода |
| `edit_expense\|` | Режим редактирования записи расхода |
| `cancel_edit` | Отмена редактирования записи |
| `edit_history` | Режим редактирования истории расходов за день |
| `edit_category\|` | Режим редактирования расходов по категории |

## Обработка сообщений

| Тип | Описание |
|-----|----------|
| `text` | Обработка ввода расходов |

## Обработка ошибок

| Тип | Описание |
|-----|----------|
| `catch` | Обработка глобальных ошибок бота |

## Структура навигации

```
Главное меню (/start, /menu)
├── Статистика (/stats)
│   └── Назад к статистике (back_to_stats)
├── История (/history)
│   ├── Редактирование истории (edit_history)
│   └── Назад к истории (back_to_history)
├── Категории (/categories)
│   ├── Просмотр категории (show_category|)
│   ├── Редактирование категории (edit_category|)
│   └── Назад к категориям (back_to_categories)
├── Настройки (/settings)
│   ├── Валюта (change_currency, set_currency|)
│   ├── Часовой пояс (change_timezone, tz|, time|)
│   ├── Язык (change_language, set_language|)
│   └── Назад к настройкам (back_to_settings)
├── Справка (/help)
├── Лимиты (/limits)
├── Экспорт (/export)
├── Отмена (/undo)
└── Общая статистика (/total)
```

## Примечания

- Все callback actions используют префикс `errorHandler` для обработки ошибок
- Навигация "назад" реализована через захардкоженные callback'и для каждой страницы
- Редактирование записей работает через состояние пользователя (stateService)
- Локализация поддерживается для всех текстовых элементов
- Валюты и часовые пояса сохраняются в базе данных для каждого пользователя 